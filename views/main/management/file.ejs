<div id="file-tab" class="tab-content">
    <div class="right delete" style="width:100%">
        <div class="container">
            <div>
                <h3>File List</h3>
                <select id="leftFile" size="15">
                </select>
                <br /><br />
                <button type="button" id="reloadFile" class="reload file">Reload Files</button> <br /><br /><br />
            </div>

            <div id="wrapper" style="margin-left: 20px">
                <table>
                    <col width="100" />
                    <col width="200" />
                    <tr>
                        <th>Visible</th>
                        <th>Class Name</th>
                    </tr>
                </table>
                <table id="option">
                    <col width="100" />
                    <col width="200" />
                    <tr>
                        <th><input type="checkbox" val="test" /> </th>
                        <td>My test class</td>
                    </tr>
                </table>
            </div>

        </div>
    </div>
</div>

<script>
    $('#reloadFile').click(function(){
        $.get('api/getFiles?',function(data){
            var select= $('#leftFile');
            if(data.error){
                onError(data);
            }else{
                select.text('');
                for(var i=0;i<data.data.length;i++){
                    var obj = data.data[i];
                    var text = obj.USERNAME? obj.FILENAME+'('+obj.USERNAME+')':obj.FILENAME;
                    var value = obj.FILEID+'-'+obj.USERID;
                    var option = createOption(text,value);
                    select.append(option);
                }
            }
        });
    });

    var fileid,userid;
    $("#leftFile").change(function(ev){
        var sp = $(this).find(':selected')[0].value.split('-');
        fileid = sp[0];
        userid = sp[1];
        $.get('api/getPermission?fileid='+fileid+'&instructor='+userid,function(data){
            console.log(data);
            if(data.error)
                onError(data);
            else{
                $('#option').find('tr').remove();
                for(var i=0; i<data.data.length;i++){
                    var obj = data.data[i];
                    var tr = makeEl('tr');
//                <tr>
//                    <th><input type="checkbox" val="test" /> </th>
//                    <td>My test class</td>
//                    </tr>
                    var th = makeEl('th');
                    $(th).html("<input class='sfp' type='checkbox' value='"+obj.CRN+"'" +(obj.FILEID?'checked=true':'') +" />");
                    var td =makeEl('td');
                    $(td).html(obj.CLASSNAME);
                    $(tr).append(th).append(td);
                    $('#option').append(tr);
                }
            }
        });
    });

    $('#option').on('click','.sfp',function(){
        var crn = $(this)[0].value;
        $.get('/api/changePermission?crn='+crn+'&fileid='+fileid+($(this)[0].checked?'':'&del='),function(data){
            console.log(data);
            if(data.error)
                onError(data);
            else{

            }
        });
    })
</script>